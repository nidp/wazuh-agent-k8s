apiVersion: apps/v1
kind: DaemonSet
metadata:
  labels:
    app: wazuh-agent
  name: wazuh-agent
  namespace: wazuh
spec:
  selector:
    matchLabels:
      app: wazuh-agent
  template:
    metadata:
      labels:
        app: wazuh-agent
    spec:
      volumes:
      - name: syslog
        hostPath:
          path: /var/log/syslog
      - name: apache-error
        hostPath:
          path: /var/log/apache2/error.log
      - name: apache-access
        hostPath:
          path: /var/log/apache2/access.log
      - name: syslog-secure
        hostPath:
          path: /var/log/secure
      - name: yum
        hostPath:
          path: /var/log/yum.log
      - name: kernel
        hostPath:
          path: /var/log/kern.log
      containers:
      - image: nidp/wazuh-agent
        name: wazuh-agent
        volumeMounts: 
        - name: syslog
          mountPath: /var/log/syslog
        - name: apache-error
          mountPath: /var/log/apache2/error.log
        - name: apache-access
          mountPath: /var/log/apache2/access.log
        - name: syslog-secure
          mountPath: /var/log/secure
        - name: yum
          mountPath: /var/log/yum.log
        - name: kernel
          mountPath: /var/log/kern.log
        env:
        - name: JOIN_MANAGER
          value: "IP ADDR"
        - name: JOIN_MANAGER_MASTER_HOST
          value: "IP ADDR"
        - name: JOIN_MANAGER_WORKER_HOST
          value: "IP ADDR"
        - name: JOIN_MANAGER_PROTOCOL
          value: "https"
        - name: NODE_NAME
          value: "TEST"
        - name: WAZUH_GROUPS
          value: NID
        - name: JOIN_MANAGER_API_PORT
          value: "55000"
        - name: JOIN_MANAGER_PORT
          value: "1514"
        - name: HEALTH_CHECK_PROCESSES
          value: "ossec-execd,ossec-syscheckd,ossec-logcollector,wazuh-modulesd,ossec-authd"
